
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.0">
    
    
      
        <title>Tracing - PyTypes Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#functionality" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PyTypes Documentation" class="md-header__button md-logo" aria-label="PyTypes Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyTypes Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tracing
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/pvs-hd-tea/PyTypes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PyTypes Documentation" class="md-nav__button md-logo" aria-label="PyTypes Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    PyTypes Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pvs-hd-tea/PyTypes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Workflow
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Workflow" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Workflow
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fetching/" class="md-nav__link">
        Fetching
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tracing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tracing
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functionality" class="md-nav__link">
    Functionality
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foundations-principles" class="md-nav__link">
    Foundations &amp; Principles
  </a>
  
    <nav class="md-nav" aria-label="Foundations &amp; Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#syssettrace" class="md-nav__link">
    sys.settrace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effect-on-coverage-debugging-and-other-trace-related-tooling" class="md-nav__link">
    Effect on Coverage, Debugging and other trace-related Tooling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    API
  </a>
  
    <nav class="md-nav" aria-label="API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decoratorstrace-minimally-intrusive-tracing-api" class="md-nav__link">
    @decorators.trace - Minimally Intrusive Tracing API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracer-setting-syssettrace-and-collecting-data" class="md-nav__link">
    Tracer - Setting sys.settrace and Collecting Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batchtraceupdate-simplifying-and-batching-trace-updates" class="md-nav__link">
    BatchTraceUpdate - Simplifying and Batching Trace Updates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../annotating/" class="md-nav__link">
        Annotating
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../evaluating/" class="md-nav__link">
        Evaluating
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Misc
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Misc" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Misc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/config/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/resolver/" class="md-nav__link">
        Types, Modules & Qualified Names
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/fetching/" class="md-nav__link">
        Fetching
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tracing/" class="md-nav__link">
        Tracing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimising/" class="md-nav__link">
        Optimising
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/typegen/" class="md-nav__link">
        Annotating
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/evaluation/" class="md-nav__link">
        Evaluation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/common/" class="md-nav__link">
        Common
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../accounting/" class="md-nav__link">
        Accounting
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functionality" class="md-nav__link">
    Functionality
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foundations-principles" class="md-nav__link">
    Foundations &amp; Principles
  </a>
  
    <nav class="md-nav" aria-label="Foundations &amp; Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#syssettrace" class="md-nav__link">
    sys.settrace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effect-on-coverage-debugging-and-other-trace-related-tooling" class="md-nav__link">
    Effect on Coverage, Debugging and other trace-related Tooling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    API
  </a>
  
    <nav class="md-nav" aria-label="API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decoratorstrace-minimally-intrusive-tracing-api" class="md-nav__link">
    @decorators.trace - Minimally Intrusive Tracing API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tracer-setting-syssettrace-and-collecting-data" class="md-nav__link">
    Tracer - Setting sys.settrace and Collecting Data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batchtraceupdate-simplifying-and-batching-trace-updates" class="md-nav__link">
    BatchTraceUpdate - Simplifying and Batching Trace Updates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/pvs-hd-tea/PyTypes/edit/gh-pages/docs/workflow/tracing.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



  <h1>Tracing</h1>

<h2 id="functionality">Functionality<a class="headerlink" href="#functionality" title="Permanent link">&para;</a></h2>
<p>The tracing module contains classes that facilitate the tracing process behind a user-friendly API.
Note that it does not offer a command for performing the tracing procedure, which should instead be done by executing the <a href="../fetching/">decorated tests of the project</a>.
The testing process can be highly customised on a per-project basis, and as such represents a high-effort low-reward coding investment on this project's end.</p>
<h2 id="foundations-principles">Foundations &amp; Principles<a class="headerlink" href="#foundations-principles" title="Permanent link">&para;</a></h2>
<h3 id="syssettrace"><a href="https://docs.python.org/3/library/sys.html#sys.settrace">sys.settrace</a><a class="headerlink" href="#syssettrace" title="Permanent link">&para;</a></h3>
<p><code>sys.settrace</code> is a Python function that allows a callable to be set that is invoked on every line of Python code that comes after it.
This registered callable, henceforth refered to as the trace function is expected to have three arguments:</p>
<ul>
<li>
<p><code>frame</code>: a representation of the current stack frame, containing references to further execution-related objects, such as:</p>
<ul>
<li>the previous frame</li>
<li>visible globals </li>
<li>variables that have been placed on the stack</li>
<li><a href="https://docs.python.org/3/library/inspect.html">and more</a></li>
</ul>
</li>
<li>
<p><code>event</code>: a string indicating the manner in which the current line of Python is handled. Relevant for us are:</p>
<ul>
<li>call: a callable was entered</li>
<li>line: plain line of code that is about to be executed (NOTE: this means the line will executed in the next interpreter step, not when it is encountered by the <code>trace</code> function)</li>
<li>return: a callable is about to return</li>
</ul>
</li>
<li>
<p><code>arg</code>: a value that differs depending on the given event. Relevant for us are:</p>
<ul>
<li>call: <code>arg</code> is None. Retrieving the values of arguments is to be performed separately.</li>
<li>line: <code>arg</code> is None. Retrieving the values of variables on this line is also to be performed separately.</li>
<li>return: <code>arg</code> is the value that will be returned from the callable.</li>
</ul>
</li>
</ul>
<h3 id="effect-on-coverage-debugging-and-other-trace-related-tooling">Effect on Coverage, Debugging and other trace-related Tooling<a class="headerlink" href="#effect-on-coverage-debugging-and-other-trace-related-tooling" title="Permanent link">&para;</a></h3>
<p>While this approach is very powerful, it comes at a detriment to the development process.
<a href="https://docs.python.org/3/library/pdb.html">pdb</a>, which is the Python debugger, uses the <code>sys.settrace</code> API to provide information during debugging sesesions.
Similarly, the <a href="https://coverage.readthedocs.io/en/6.4.4/">coverage</a> tool, which provides code-coverage information of Python programs, also uses this entrypoint.</p>
<p><code>sys.settrace</code> only allows for one trace function to be set, meaning no tooling that also uses this API can coexist with another.
Therefore, along a codepath that uses the entrypoint in question, determining code coverage, or attempting to debug, is simply not possible.</p>
<h2 id="api">API<a class="headerlink" href="#api" title="Permanent link">&para;</a></h2>
<p>The project implements the required functionalities in the <code>tracing</code> module, in the classes of <code>Tracer</code> and <code>TraceBatchUpdate</code>, which trace and collect instances into a <code>DataFrame</code> by the following schema:</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Meaning</th>
<th>Type</th>
<th>Null?</th>
</tr>
</thead>
<tbody>
<tr>
<td>Filename</td>
<td>Relative path to file of traced instance from project root</td>
<td>string</td>
<td>Never</td>
</tr>
<tr>
<td>ClassModule</td>
<td>Module of class traced instance is in</td>
<td>string</td>
<td>When not in a class' scope</td>
</tr>
<tr>
<td>Class</td>
<td>Name of class traced instance is in</td>
<td>string</td>
<td>When not in a class' scope</td>
</tr>
<tr>
<td>FunctionName</td>
<td>Name of function traced instance is in</td>
<td>string</td>
<td>When not in a function's scope</td>
</tr>
<tr>
<td>LineNo</td>
<td>Line number traced instance occurs on</td>
<td>uint</td>
<td>Never</td>
</tr>
<tr>
<td>Category</td>
<td>Number identifying context traced instance appears in</td>
<td>int</td>
<td>Never</td>
</tr>
<tr>
<td>VarName</td>
<td>Name of traced instance</td>
<td>string</td>
<td>Never</td>
</tr>
<tr>
<td>TypeModule</td>
<td>Module of traced instance's type</td>
<td>string</td>
<td>When the type is builtin</td>
</tr>
<tr>
<td>Type</td>
<td>Name of traced instance's type</td>
<td>string</td>
<td>Never</td>
</tr>
</tbody>
</table>
<p>Category can take on 5 different values, which are contained in the <code>TraceDataCategory</code> enum class: <code>LOCAL_VARIABLE</code>, <code>GLOBAL_VARIABLE</code>, <code>CLASS_MEMBER</code>, <code>FUNCTION_PARAMETER</code> and <code>FUNCTION_RETURN</code>.</p>
<h3 id="decoratorstrace-minimally-intrusive-tracing-api"><code>@decorators.trace</code> - Minimally Intrusive Tracing API<a class="headerlink" href="#decoratorstrace-minimally-intrusive-tracing-api" title="Permanent link">&para;</a></h3>
<p><a href="../fetching/">The fetching process</a> generates instances of this decorator function where applicable.
Each invocation parses the <a href="../../misc/config/">config file</a> from the root of the project, and executes the tracing process on the marked callable.
This decorator takes care to forward all arguments that <code>pytest</code> may inject into the decorated function so that all kinds of <a href="https://docs.pytest.org/en/latest/how-to/monkeypatch.html">monkeypatching</a>, <a href="https://docs.pytest.org/en/latest/how-to/fixtures.html">fixtures</a> and much else.</p>
<p>After tracing has concluded, the accumulated <code>DataFrame</code> in the <code>Tracer</code> is serialised under <code>pytypes/{project}/{test_case}/{func_name}-{hash(df)}.pytype</code>.
The hashing is performed to force tests that are executed in loops (e.g. by <code>@pytest.mark.parametrize</code>) to not overwrite their predecessor's data, which could cause valuable information that would indicate union types, to be lost.
If the traced test causes an uncaught exception, then a similarly named file with an <code>.err</code> suffix is generated containing the traceback.</p>
<p>Additionally, if the <code>benchmark_performance</code> value has been set to true in <code>pytypes.toml</code>, then additional tracing will be performed that does not store any trace data, and again with logging enabled but with optimisations turned off.
The runtimes for each execution are serialised next to the logged trace files.</p>
<h3 id="tracer-setting-syssettrace-and-collecting-data">Tracer - Setting <code>sys.settrace</code> and Collecting Data<a class="headerlink" href="#tracer-setting-syssettrace-and-collecting-data" title="Permanent link">&para;</a></h3>
<p>The events generated by the trace function are caught in the <code>Tracer</code> class' <code>_on_trace_is_called</code> method after its <code>start_trace</code> method has been called.
This ends when its <code>end_trace</code> method being called.
This functionality has again been wrapped in its <code>active_trace</code> method, which can be used in Python's <code>with</code> statements.
These methods are called from the <code>@decorators.trace</code> function, as documented in the <a href="#decoratorstrace---minimally-intrusive-tracing-api">previous section</a>.</p>
<p>The implementation backs-up any previously set trace function by reading from <code>sys.gettrace</code>, and sets its own using <code>sys.settrace</code>.
This newly set trace function handles the <code>call</code>, <code>line</code> and <code>return</code> events, and ignores the <code>exception</code> and <code>opcode</code> events, as no relevant data can be gleamed from these.
Each event is handled in its own appropriately named method, and the tracer combines the <code>DataFrame</code>s generated by <code>BatchTraceUpdate</code>.
When tracing is halted, the <code>DataFrame</code> is deduplicated to remove redundant information and the old trace function is restored.</p>
<p>During tracing, the values for <code>TypeModule</code> and <code>Type</code> are derived from the <code>type</code> function, which is passed to the <a href="../../misc/resolver/">Resolver</a> to mirror components to Python's <code>from x.y import z</code> import style.</p>
<h3 id="batchtraceupdate-simplifying-and-batching-trace-updates">BatchTraceUpdate - Simplifying and Batching Trace Updates<a class="headerlink" href="#batchtraceupdate-simplifying-and-batching-trace-updates" title="Permanent link">&para;</a></h3>
<p>Despite the events emitted by <code>sys.settrace</code> being disjunct, the operations that must be performed on the basis thereof are not.
For example, the handling of the <code>return</code> event is a superset of that of the <code>line</code> event. 
Furthermore, the <code>line</code> event must perform update operations for both local and global variables.
Also, the general functionality necessary to update the <code>DataFrame</code> is repetitive, especially with <code>FileName</code>, <code>ClassModule</code>, <code>Class</code> and <code>FunctionName</code> being identical for every trace call within the same function.</p>
<p>The <code>BatchTraceUpdate</code> class was designed to solve these issues; the aforementioned repetitive data is passed to the constructor, to be reused in its methods.
These methods form a builder-pattern style interface for each relevant category, allowing updates to be chained as each event requires.
After all updates have been handled, a <code>DataFrame</code> can be produced that is to added to the otherwise accumulated trace data.</p>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../fetching/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Fetching" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Fetching
            </div>
          </div>
        </a>
      
      
        
        <a href="../annotating/" class="md-footer__link md-footer__link--next" aria-label="Next: Annotating" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Annotating
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
    
  </body>
</html>